<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <title>ModBus Module — Keep Talking and Nobody Explodes Module</title>
        <meta name="viewport" content="initial-scale=1">
        <link rel="stylesheet" type="text/css" href="css/normalize.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link href='https://fonts.googleapis.com/css?family=Special+Elite' rel='stylesheet' type='text/css'>
        <script src="js/highlighter.js"></script>
        <style>
            table {
                margin: 1em auto;
            }

            /* Example CSS; Remove what is not used.*/
            .bold {
                font-weight: bold;
            }
            .underline {
                text-decoration: underline;
            }
            .italics {
                font-style: italic;
            }

            img.center {
                display: block;
                margin-left: auto;
                margin-right: auto;
            }
            img.example-image {
                width: 60%;
            }
        </style>
		<style>
            /* Remove this <style> block in final manual! */
            code {background-color: rgb(235, 235, 200);}
            code.notcode {background-color: white;}
            li ol {margin: 0;}
            kbd {background-color: #f5f5f5;border-style: solid;border-width: 1px 2px 2px 1px;padding: 0 1px;}
        </style>
    </head>
    <body>
        <div id="ManualContent">
            <div class="section">
                <div class="page page-bg-02">
                    <div class="page-header">
                        <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                        <span class="page-header-section-title">ModBus Module</span>
                    </div>
                    <div class="page-content">
                        <img src="img/Component/Module Name.svg" class="diagram">
                        <h2>On the Subject of ModBus </h2>

						<h3>Summary </h3>

						<ol>
                            <li>Glossary</li>
                            <li>History</li>
							<li>Goal</li>
							<li>ModBus Protocol</li>
							<li>Address</li>
							<li>Functions</li>
                        </ol>


						
						<h3>Glossary </h3>




						<h3>History </h3>
                        <p class="flavour-text">A little of History is good, right? </p>

                        <p>The ModBus is a serial communications protocol originally published by Modicon in 1979, for use with it's PLCs (Programmable logic controllers). </p>
						<p>It's commonly used as means of connecting industrial electronic devices. Here it has been used to make a bomb.<br>


						<h3>Goal </h3>
						<p class="flavour-text">You just have to follow the instructions. It's as simple as cooking a turkey!</p>

						<p>To defuse the module, it is simple. Decode the protocol and send the correct frame.</p>
						<p>Do not send anything before you are done writing the frame!</p>

						<p class="flavour-text">correct frame? send anything? What??</p>

						<p>If everything I've said scared you, just read the part ModBus Protocol carefully and follow the example.


                        <h3>ModBus Protocol</h3>
						<p class="flavour-text"> "READ THIS SECTION CAREFULLY! PLEASE!"</p>

						<p>Here is the frame, for advance programmer, you know how to do it.</p>
						<p>If not, go to "annex - How to write ModBus frame ?".</p>

                        <img src="img/frameModBus.png" width="500" />

						<p class="flavour-text"> Booom ModBus Protocol! <br>
                        </p>

						<p> PS : 16 bits word (2 bytes) are sent in "Big endian". (Most Significant Byte First).<br>


						<h3> Address </h3>
						<p class="flavour-text"> "Where do I have to send the defuse code ?"</p>
						<p> The address part define where you want to access the memory.</p>

						<p>Convert the first number (or letter) from ASCII to hexadecimal number (See Annex - ASCII Tab), it's the address (yay!).</p>
						<p> Do not use decimal numbers! </p>
						<p class="flavour-text"> "Got some trouble ? Check annex - How to decode address ModBus"</p>


						<h3> Functions </h3>
						<p class="flavour-text"> "Hmm... I guess it's an important section..."</p>
						<p>Here, the module use only 2 function :</p>
						<ul>
                            <li>Function 04, used to read a data word.</li>
                            <li>Function 06, used to write a data word.</li>
                        </ul>
						<p>In order to find the right function to pick, you need to :</p>
						<ol>
							<li>Convert the last number (or letter) from ASCII to decimal number (See Annex - ASCII Tab),</li>
							<li>Take the modulo 4 of this number (e.g. 12%4 = 0, 15%4 = 3),</li>
							<li>Multiply by 3,</li>
							<li>Take the modulo 2 of the result.</li>
						</ol>
						<p>This number should be 0 or 1, if not, you havn't done the modulo 2 correctly...</p>
						<p>If the result is :</p>
						<ul>
                            <li> 0, use function 06.</li>
                            <li> 1, use function 04.</li>
                        </ul>
						<p>When it said function 06, you need to write "06" for function part. </p>
						<p>The next section is divided into 2 parts, the data for the function 04 and for the function 06.
						Pick the one you find in function part.</p>


						<h3>Data for Function 04</h3>
						<p class="flavour-text"> Read the right data, defuse the module, be a hero. BOOM dream achieved.</p>


						
                    </div>
                   <div class="page-footer relative-footer">Page 1 of 5</div>
                </div>
                <div class="page page-bg-01">
                    <div class="page-header">
                        <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                        <span class="page-header-section-title">ModBus Module</span>
                    </div>
                    <div class="page-content">
                        <!--Added an 's' to Function.-->
                        <h3> Functions </h3>
						<p class="flavour-text"> "Hmm... I guess it's an important section..."</p>
						<p> Terrorists (or defusers, or someone else?) use only 2 functions :</p>
						<ol>
                            <li>Function 04, used to read a data word. (Yes, we'll have to use it)</li>
                            <li>Function 06, used to write a data word.</li>
                        </ol>
						<p> The choice is simple, look at the last number (or letter) of the serial code, then convert it from ASCII to a decimal number. Only then can you calculate the modulo 4 of this number(e.g. 12%4 = 0,&nbsp;15%4 = 3)</p>
						<p class="flavour-text"> "Simple, right?" </p>
						<!--<br>-->
						<p> After that, multiply by 3, and calculate the modulo 2 of the result<br>
						If the result is ... </p>
						<ol>
                            <li>&nbsp;... 0, use function 04.</li>
                            <li>&nbsp;... 1, use function 06.</li>
                        </ol>
						<h3>Function 04</h3>
						<p class="flavour-text"> Read data, defuse the module, be a hero. BOOM dream achieved.</p>
						<p>The Bomb-maker developed a new kind of protection. Instead of using writing function to defuse their module, you only need to read the right data on the module using function 04.</p>
                            <!--Commented out the 'Don't care about it.' as for the purposes of a manual it may be misleading to a new reader. Feel free to put it back in if you desire.-->
							<!--<p class="flavour-text">Don't care about it. </p>
							<br>-->
							<p>So, How is the data area even composed? (Read the diagram below)</p>
						<img src="img/FrameFunction04.png" width="400" />
						<p class="flavour-text"> You see, It's the last 4 byte to find! Keep calm and defuse it! </p>
                    </div>
                   <div class="page-footer relative-footer">Page 2 of 5</div>
                </div>
                <div class="page page-bg-03">
                    <div class="page-header">
                        <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                        <span class="page-header-section-title">ModBus Module</span>
                    </div>
                    <div class="page-content">
						<h4>Address of the word</h4>
						<p> First, to find the word address, multiply the third digit by the fourth digit.</p>
							<p>Letters, convert them in decimal with annex ASCII Tab.
							Numbers, don't change them like before. Instead, take the number write. (If it's write 5, take 5.) Next, multiply the result by 100. Then, just take the least significant byte. <br>
							i.e. : (45BA72C)<SUB>HEX</SUB> -> (A72C)<SUB>HEX</SUB> <br> </p>
						<h4>Number of word to read</h4>
                        <!--Reworded from 'You should think,...' to '...I will tell you, Yes.'-->
						<p> Hmmm, you should think, "I will read 210 words, that's nonsense!", and I will tell you, Yes. That is actually nonsense!</p>
                        <p>
							Luckily, It does not work exactly like that, The Bomber that used this function is sneaky, so they didnt use it for it's real purpose.</p>
                            <p>Please find those 2 last bytes (even if they don't relate to anything).</p>
							<p>Take the address of the slave (decimal), multiply by the the number of function (4 or 6) then add the data number (decimal too).<br>
							Convert the reinto Hexa the result, simplify like just right before. And you got it!</p>

							<p>Send the data and you will be a hero (or not if you failed).</p>

						<h3>Function 06</h3>
                        <!--Removed an extra 'L' from Carefull-->
						<p class="flavour-text"> Be careful, the keyboard is stronger than the sword! </p>
						<p> You previously determine the slave address and the function "write". <br>
							But now you need to search what you need to write? and where (in him slave memory)? <br>
							See below, how complete the data area when you want to write something.
						<img src="img/FrameFunction06.png" width="400" />
						<p class="flavour-text"> I believe in you! You got this! </p>
                    </div>
                    <div class="page-footer relative-footer">Page 3 of 5</div>
                </div>
				<div class="page page-bg-04">
                    <div class="page-header">
                        <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                        <span class="page-header-section-title">ModBus Module</span>
                    </div>
                    <div class="page-content">
						<h4>Address in the register</h4>
                        <!--'I hope you review your binary operation become you will use it' to 'I hope you have reviewed your binary operations because you will need to use it!'-->
						<p>I hope you have reviewed your binary operations because you will need to use it! (It's not a joke.)
                        <p>First step, take the 4th number (or letter, there are all ASCII) and convert it with ASCII table on page 5 (in binary this time).</p>

                        <!--Changed 'got' to 'have','exemple' to 'Example'-->
						<p>When you have the number, complete with some 0 before to convert it into the same number in 16 bits this time. Example: 101 = 0000 0101 (for 8 bits).<br>
						You have to invert this number (NOT Operation), truth table below :</p>
						<table>
							<tr>
								<th>&nbsp;&nbsp; A &nbsp;&nbsp; </th>
								<th>NOT A</th>
							</tr>
							<tr>
								<td> &nbsp;&nbsp; 1 </td>
								<td> &nbsp;&nbsp; 0 </td>
							</tr>
							<tr>
								<td> &nbsp;&nbsp; 0</td>
								<td> &nbsp;&nbsp; 1</td>
							</tr>
						</table>
						<p> You just have to convert the 16 bits binary number into an decimal number.<br>
							Simplify by cut the higher value. i.e. : 265486 -> 5486 <br>
							Annnnndddd, you got the address in the register.</p>

						<h4>Value</h4>
						<p> The last part is the easiest! Since you must only find the value to enter at this address, take the first serial number (decimal) subtract the number of function.<br>
							Then multiply this result by the 5th serial Number (or lettre), in decimal for sure. Simplify like you have done before.</p>
						<p> If you're there, you'd think it's finished, and yes, it's actually finished! <br>
							Now, enter all parameter in the right order, and click on the send button.<br>
							YOU DID IT MY BOY!</p>
                    </div>
                    <div class="page-footer relative-footer">Page 4 of 5</div>
                </div>
				<div class="page page-bg-05">
                    <div class="page-header">
                        <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                        <span class="page-header-section-title">Appendix Name</span>
                    </div>
                    <div class="page-content">
						<h2>Annex ASCII table</h2>
						<img src="img/ascii_table.png" width="650" />
						<p class="flavour-text"> When you need to convert a letter (or an number in some cases), you need to find the letter (or number) into the Char column <br>
												 Bonus : You got Dec/Bin/Hex/Char Convertion</p>
                    </div>
                    <div class="page-footer relative-footer">Page 5 of 5</div>
                </div>
            </div>
        </div>
    </body>
</html>
